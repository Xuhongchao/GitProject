package com.wisetrust.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import javax.validation.Valid;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.wisetrust.request.LoginRequest;

/**
 * Created by @author xu on @date 2018年 1月 4日 下午3:08:49
 * 
 * 登陆控制器
 */
@Controller
@RequestMapping(value = "/")
public class LoginController {

	/**
	 * 登陆
	 * 
	 * @param model
	 * @return
	 */
	@RequestMapping(value = "login", method = RequestMethod.GET)
	public String login(Model model) {
		LoginRequest loginRequest = new LoginRequest();
		model.addAttribute("loginRequest", loginRequest);
		return "login";
	}

	/**
	 * 登陆检查
	 * 
	 * @param loginRequest
	 *            登陆时存放用户名和密码
	 * @return
	 */
	@RequestMapping(method = RequestMethod.POST)
	public String loginCheck(@Valid @ModelAttribute("loginRequest") LoginRequest loginRequest, BindingResult result,
			HttpServletRequest request) {

		if (result.hasErrors()) {
			return "login";
		}
		request.getSession().setAttribute("loginAccount", loginRequest.getUsername());
		return "redirect:/index/" + loginRequest.getUsername();
	}

	/**
	 * 退出登录
	 * 
	 * @param request
	 * @return
	 */
	@RequestMapping(value = "/logout")
	public String logout(HttpServletRequest request) {
		HttpSession session = request.getSession();
		Object obj = session.getAttribute("loginAccount");
		if (obj != null) {
			session.removeAttribute("loginAccount");
			return "login";
		}

		return "error";
	}

}
